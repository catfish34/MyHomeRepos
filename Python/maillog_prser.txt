import re

maillog = ('/home/iana/maillog')
# postfix/qmgr - holds the time an email was removed from que or its size, sender and number of recipients.
# postfix/smtp - destination, delay, relay and status (which can be sent, bounced, deferred) as well as aditional information regarding the operation (errors encountered while trying to send the email and such).
# postfix/smtpd - the Host/IP Address of the client connected to the SMTP daemon.
# postfix/cleanup - the message id of the currently processed email.

file_handler = open(maillog, 'r')

for line in file_handler:
    if "postfix/qmgr" in line:
        t=re.findall ('[0-9-A-F]+', line)
        qmgr = line.split(" ")
        date = ' '.join(qmgr[0:3])
        for element in qmgr[6:7]:
            sender_l = element.find("<")
            sender_r = element.find(">")
            sender = ''.join(element[sender_l+1:sender_r])
        queue_id =  ''.join(qmgr[5:6])
        size = ''.join(qmgr[7:8])
        number_of_recep = ''.join(qmgr[8:9])
        if "removed" in qmgr:
            print "True"
        print date, "ID in QUEUE: ", queue_id, "FROM: ", sender, "SIZE:", size, "Number of recipients: ", number_of_recep
        
#     elif "postfix/smtp[" in line:
#         qmgr = line.split(" ")
#         ln = len(qmgr)
#         status = qmgr[6:ln]
#         print status
#     elif "postfix/smtpd" in line:
#         qmgr = line.split(" ")
#         host = qmgr[6:7]
#         print host
#     elif "postfix/cleanup" in line:
#         qmgr = line.split(" ")
#         msg_id = qmgr[5]
#         print msg_id
    else:
        continue
