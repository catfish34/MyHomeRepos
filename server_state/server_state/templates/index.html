<!DOCTYPE html>
{% load staticfiles %}
<head>
    <meta charset="utf-8">
    <title></title>
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <script src="{% static 'js/jquery.min.js' %}"></script>
    <script src="{% static 'js/bootstrap.min.js'  %}"></script>
</head>
<style>
    div.status {
        color: rgb(255,255,255);
        text-align: left;
        font-size: small;
    }
    body {
        background-color: lightgoldenrodyellow;
    }
    button {
        box-shadow: 0 3px 0 0 #007299;
        width: 100%;
        text-justify: auto;
    }
    form#status {
        border: 2px solid #a1a1a1;
        background: #dddddd;
        border-radius: 5px;
        background-color: rgb(0,0,0);
    }
</style>
<div class="container-fluid" style="margin-top: 10%;">
    <form class="form-horizontal col-xs-4 col-xs-offset-3" role="form">
    {% for choice in possible_states %}
        {% if choice.0 == 'ON' %}
            <div class="form-group">
                    <button id="{% url 'change_state' choice.0 %}" type="button" class="btn btn-success"
                        onclick="change_state('{{ choice.0 }}', this.id)">{{ choice.0 }}</button>
            </div>
        {% elif choice.0 == 'OFF' %}
            <div class="form-group">
                <button id="{% url 'change_state' choice.0 %}" type="button" class="btn btn-danger"
                        onclick="change_state('{{ choice.0 }}', this.id)">{{ choice.0 }}</button>
            </div>
        {% else %}
            <div class="form-group">
                <button id="{% url 'change_state' choice.0 %}" type="button" class="btn btn-primary"
                        onclick="change_state('{{ choice.0 }}', this.id)">{{ choice.0 }}</button>
            </div>
        {% endif %}
    {% endfor %}
    </form>
    <form role="form" id="status" class="col-xs-10">
        <div class="row" >
            {% for state in server_state %}
                <div class="status">
                    Current state: {{ state.current_state }}
                </div>
                <div class="status">
                    Last updated: {{ state.last_updated|date:'Y-m-d H:i' }}
                </div>
            {% endfor %}
        </div>
    </form>
</div>
<script>
    function change_state(message, id) {
        var action = confirm("Вы уверенны, что хотите переключить сервер в состояние: " + message + " ?");
        if (action) {
            $.ajax({
                url: id,
                method: "GET",
            }).fail(function(jqXHR, textStatus) {
                alert( "Error contacting server, try the same again!" + textStatus + jqXHR);
            }).done(function () {
                alert("Состояние сервера изменится через минуту!")
                location.reload();
            });
        }
    }
</script>
</body>
</html>